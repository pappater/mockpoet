# Setup Guide: The Sun Also Rises Again

This guide walks through setting up the Hemingway-style novel feature.

## Overview

**The Sun Also Rises Again** is a complete novel written in the distinctive style of Ernest Hemingway. Unlike daily generation scripts, this novel is generated all at once with approximately 25 chapters (200-500 pages) featuring simple, direct prose and heavy use of dialogue.

## Prerequisites

Before starting, ensure you have:
- A GitHub account
- A Google Gemini API key ([Get one here](https://makersuite.google.com/app/apikey))
- A GitHub Personal Access Token with `gist` scope

## Setup Steps

### 1. Create a New GitHub Gist

1. Go to [gist.github.com](https://gist.github.com)
2. Click "Create a new gist"
3. For the filename, enter: `README.md`
4. For the content, add:
   ```markdown
   # The Sun Also Rises Again
   
   A complete novel in the style of Ernest Hemingway.
   
   Generated by the rabbit platform.
   ```
5. Make sure it's set to **Public** (not Secret)
6. Click "Create public gist"
7. Copy the Gist ID from the URL
   - URL format: `https://gist.github.com/username/abc123def456`
   - Copy the ID part: `abc123def456`

### 2. Add GitHub Secret

1. Go to your repository's Settings
2. Navigate to **Secrets and variables** → **Actions**
3. Click **New repository secret**
4. Name: `HEMINGWAY_GIST_ID`
5. Value: Paste the Gist ID you copied
6. Click **Add secret**

### 3. Verify Other Required Secrets

Ensure these secrets are also set:
- `GEMINI_API_KEY` - Your Google Gemini API key
- `GIST_TOKEN` - GitHub Personal Access Token with gist scope

### 4. Run the Generator

You can run the generator locally or create a workflow:

#### Local Execution

```bash
# Set environment variables
export GEMINI_API_KEY="your-gemini-api-key"
export GEMINI_MODEL="gemini-2.5-flash"
export GIST_TOKEN="your-github-token"
export HEMINGWAY_GIST_ID="your-gist-id"

# Install Python dependencies
pip install -r scripts/hemingway-novel/requirements.txt

# Run the generator
python3 scripts/hemingway-novel/hemingway_novel_to_gist.py
```

**Note**: This will take 1-2 hours to generate all chapters.

### 5. Verify the Setup

1. Check the script output for completion status
2. Visit your Gist to see all chapters:
   - `https://gist.github.com/username/YOUR_GIST_ID`
3. Look for files:
   - `chapter_001.md` through `chapter_025.md` - Novel chapters
   - `series_bible.md` - Character and setting info
   - `outline.md` - Story structure
   - `summaries.md` - Chapter summaries
   - `continuity_log.txt` - Generation log
   - `chapters.json` - Metadata for UI

### 6. Update Configuration Files

After generation, update the Gist ID in the configuration files:

1. Edit `config.js`:
   ```javascript
   sun_also_rises_again: {
     title: "The Sun Also Rises Again",
     gist: {
       username: 'pappater',
       id: 'your-actual-gist-id'  // Replace with your HEMINGWAY_GIST_ID
     },
     localPath: 'docs/hemingway-novel'
   }
   ```

2. Edit `src/config.js` the same way

3. Commit and push these changes

### 7. Check the UI

1. Visit your deployed site or run locally: `npm run dev`
2. The home page should show "The Sun Also Rises Again" with "25 Chapters Available"
3. Click on the novel to read it

## Novel Characteristics

### Hemingway's Writing Style

The novel follows these key characteristics:

- **Short, Direct Sentences**: Simple subject-verb-object construction
- **Simple Words**: Common, concrete vocabulary
- **Heavy Dialogue**: At least 50% of each chapter is conversation
- **Understated Emotion**: Show feelings through action, not description
- **Iceberg Theory**: Much implied, little explained
- **Concrete Details**: Specific sensory observations
- **Minimal Description**: Focus on what happens, not how it feels

### Structure

- **25 Chapters**: Each approximately 2,000-3,000 words (8-12 pages)
- **Complete Story**: Full narrative arc from beginning to end
- **Linear Progression**: Clear, chronological storytelling
- **Post-War Setting**: Typically America or Europe after WWI
- **Theme**: Love, loss, and the search for meaning

### chapters.json Format

```json
{
  "novel_title": "The Sun Also Rises Again",
  "total_chapters": 25,
  "last_updated": "2025-11-07 12:00:00 UTC",
  "gist_id": "abc123def456",
  "completed": true,
  "chapters": [
    {
      "chapter": 1,
      "filename": "chapter_001.md",
      "url": "https://gist.githubusercontent.com/.../chapter_001.md",
      "gist_url": "https://gist.github.com/abc123def456#chapter_001.md",
      "chapter_name": "Paris"
    }
  ]
}
```

## Customization

### Adjusting Chapter Count

Edit `scripts/hemingway-novel/hemingway_novel_to_gist.py`:

```python
TOTAL_CHAPTERS = 30  # Change from 25 to desired number
```

### Changing the Theme

Edit the same file:

```python
THEME = "Your new theme here"
```

### Modifying Style Requirements

Edit the prompt files in `scripts/hemingway-novel/prompts/`:
- `bible_prompt.txt` - Character and setting generation
- `outline_prompt.txt` - Story structure  
- `chapter_prompt.txt` - Chapter generation with style requirements
- `summary_prompt.txt` - Chapter summaries

## Troubleshooting

### Generation Failed

Check for:
- Missing or invalid `HEMINGWAY_GIST_ID` secret
- Invalid `GEMINI_API_KEY` or quota exceeded
- Gist is set to secret instead of public
- Network connectivity issues
- Python dependencies not installed

### Novel Not Showing in UI

1. Verify `chapters.json` exists in `docs/hemingway-novel/`
2. Check Gist ID is correctly set in `config.js` and `src/config.js`
3. Ensure the Gist is public
4. Clear browser cache and reload
5. Check browser console for errors

### Style Doesn't Match Hemingway

The AI attempts to emulate Hemingway's style, but results may vary:
- Prompts emphasize key style characteristics
- Some variation is natural and expected
- Consider adjusting prompts if specific aspects need improvement
- Regenerate specific chapters if needed

### Generation Takes Too Long

- Normal generation time: 1-2 hours for 25 chapters
- Depends on Gemini API response time
- Consider reducing `TOTAL_CHAPTERS` for faster generation
- Can interrupt and resume (script tracks progress)

## Differences from Daily Novels

Unlike the daily generation scripts (Weight of Promises, etc.):

| Aspect | Daily Novels | Hemingway Novel |
|--------|--------------|-----------------|
| Generation | One chapter per day | All chapters at once |
| Schedule | Cron job (automated) | Manual execution |
| Completion | Ongoing (`completed: false`) | Complete (`completed: true`) |
| Style | Dostoevsky-like | Hemingway-like |
| Length | Variable | Fixed (25 chapters) |
| Dialogue | Some | Heavy (50%+) |

## Maintenance

### Regenerating the Novel

To create a new version:

1. Back up the existing Gist if desired
2. Either:
   - Create a new Gist and update `HEMINGWAY_GIST_ID`
   - Or delete all files from existing Gist
3. Run the script again
4. All content will be regenerated fresh

### Updating After Changes

If you modify prompts or settings:

1. Run the generation script again
2. New files will overwrite old ones in the Gist
3. Update local files with new generation
4. Commit changes to repository

## File Structure

```
rabbit/
├── docs/hemingway-novel/
│   ├── README.md                  # Documentation
│   ├── series_bible.md            # Characters and setting
│   ├── outline.md                 # Story structure
│   ├── summaries.md               # Chapter summaries
│   ├── continuity_log.txt         # Generation log
│   ├── chapters.json              # Metadata
│   └── chapter_001.md to chapter_025.md  # Chapters
├── public/docs/hemingway-novel/
│   └── chapters.json              # Deployed metadata
└── scripts/hemingway-novel/
    ├── hemingway_novel_to_gist.py # Generation script
    ├── requirements.txt           # Python dependencies
    └── prompts/
        ├── bible_prompt.txt       # Series bible template
        ├── outline_prompt.txt     # Outline template
        ├── chapter_prompt.txt     # Chapter template
        └── summary_prompt.txt     # Summary template
```

## Next Steps

After setup is complete:

1. Read and enjoy the novel
2. Share the Gist URL with readers
3. Consider regenerating with different themes
4. Customize prompts to adjust the style
5. Experiment with different chapter counts

## Resources

- [Hemingway Novel README](docs/hemingway-novel/README.md) - Detailed documentation
- [Environment Variables Guide](ENVIRONMENT_VARIABLES.md) - Secret configuration
- [Main README](README.md) - Overall project documentation
- [Hemingway's Writing Style](https://en.wikipedia.org/wiki/Ernest_Hemingway#Writing_style) - Background

## Support

If you encounter issues not covered in this guide:

1. Check the script output for specific error messages
2. Review the [Troubleshooting](#troubleshooting) section
3. Verify all environment variables are set correctly
4. Ensure Python dependencies are installed
5. Check Gemini API quota and rate limits
6. Verify the Gist is public and accessible
